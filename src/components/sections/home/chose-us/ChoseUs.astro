---
import { Icon } from "astro-icon/components";
import { FeatureCardMobile } from "@/components/sections/home/chose-us/FeatureCardMobile";
import { t } from "@/lib/utils";
import { features } from "@/config/features.json";
import Heading from "@/components/common/Heading.astro";
import FeatureCard from "./FeatureCard.astro";

const getGridClass = (i: number): string => {
  switch (i) {
    case 0:
      return "lg:col-span-3 lg:col-start-7 lg:row-span-3 lg:row-start-1";
    case 1:
      return "lg:col-span-3 lg:col-start-10 lg:row-span-3 lg:row-start-1";
    case 2:
      return "lg:col-span-3 lg:col-start-4 lg:row-span-3 lg:row-start-4";
    case 3:
      return "lg:col-span-3 lg:col-start-7 lg:row-span-3 lg:row-start-4";
    case 4:
      return "lg:col-span-3 lg:col-start-10 lg:row-span-3 lg:row-start-4";
    default:
      return "lg:col-span-3";
  }
};
---

<section class="py-12 md:py-20 px-4">
  <div class="max-w-7xl mx-auto">
    <!-- Desktop Grid -->
    <div
      class="hidden lg:grid grid-cols-12 grid-rows-6 min-h-[700px] features-wrapper"
    >
      <!-- Title - col 1-6, row 1-3 -->
      <div
        class="col-span-12 lg:col-span-6 lg:col-start-1 lg:row-span-3 lg:row-start-1 flex flex-col justify-start max-w-lg xl:max-w-xl space-y-2 px-4"
      >
        <Heading heading={t("choseus.heading")} />
        <h2
          class="text-5xl xl:text-6xl tracking-tight font-anton uppercase leading-none"
        >
          {t("choseus.title")}
        </h2>
      </div>
      <!-- Features - cols 7-12, rows 1-4 -->
      {
        features.map((f, i) => (
          <FeatureCard
            icon={f.icon}
            title={f.titleKey}
            description={f.descriptionKey}
            class={getGridClass(i)}
            variant={i % 2 === 0 ? "accent" : "default"}
          />
        ))
      }
      <!-- Arrow Icon - col 1-2, row 5-6 -->
      <div
        class="col-span-12 lg:col-span-2 lg:col-start-1 lg:row-span-2 lg:row-start-5 flex items-end justify-center lg:justify-start"
      >
        <Icon name="arrow" size={56} class="rotate-45 text-secondary" />
      </div>
    </div>

    <!-- Mobile/Tablet Layout -->
    <div class="block lg:hidden">
      <!-- Header Section -->
      <div class="space-y-3">
        <Heading heading={t("choseus.heading")} />
        <h2
          class="text-3xl md:text-4xl tracking-tight font-anton uppercase leading-none max-w-md"
        >
          {t("choseus.title")}
        </h2>
      </div>

      <!-- Carousel Section -->
      <div class="mt-2">
        <FeatureCardMobile client:load features={features} />
      </div>
    </div>
  </div>
</section>

<script>
  //Animation cards in desktop grid
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const items = document.querySelectorAll("[data-feature-card]");

  gsap.set(items, { opacity: 0, y: 40 });

  gsap.to(items, {
    opacity: 1,
    y: 0,
    duration: 0.8,
    ease: "power3.out",
    stagger: 0.15,
    scrollTrigger: {
      trigger: ".features-wrapper",
      start: "top 80%",
      end: "bottom 20%",
      toggleActions: "play none none none",
    },
  });
</script>
